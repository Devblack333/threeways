<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ThreeWays Shipping</title>
  <meta id="meta-description" name="description" content="ThreeWays — Fast. Secure. Global. Reliable shipping and freight with real tracking and friendly service.">
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <header class="header">
    <div class="logo">ThreeWays</div>

    <nav class="nav" role="navigation">
      <a href="#home" class="nav-link" data-i18n="nav_home">Home</a>
      <a href="#about" class="nav-link" data-i18n="nav_about">About</a>
      <a href="#services" class="nav-link" data-i18n="nav_services">Services</a>
      <a href="#contact" class="nav-link" data-i18n="nav_contact">Contact</a>
    </nav>

    <div class="header-right">
      <div class="call-pill">
        <span data-i18n="call_us">Call us:</span>
        <strong id="phone">+20 111 301 2341</strong>
      </div>

      <div class="lang-switch" role="radiogroup" aria-label="Language selection">
        <button id="lang-en" class="lang-btn active" aria-label="Switch to English" aria-checked="true" role="radio">EN</button>
        <button id="lang-ar" class="lang-btn" aria-label="Switch to Arabic" aria-checked="false" role="radio">AR</button>
      </div>
    </div>

    <button id="navToggle" class="nav-toggle" aria-controls="nav" aria-expanded="false">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
  </header>

  <main id="pageContent"></main>

  <footer class="footer">
    <!-- use entity to avoid encoding/font issues -->
    <p id="footer-text" class="muted">&copy; ThreeWays Shipping Company — All rights reserved</p>
  </footer>

  <!-- Inline script.js (complete, robust resolver + language swap) -->
  <script>
  /* script.js - robust image-path resolver + language swap (inlined) */

  const SITE_PHONE = "+20 111 301 2341";

  /* tiny transparent fallback (keeps layout if no image found) */
  const TRANSPARENT_PIXEL = "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";

  /* Why Us images (external stable URLs) */
  const Why1 = "https://i.postimg.cc/tJTStDSN/speed-17221155.webp";
  const Why2 = "https://images.unsplash.com/photo-1521791136064-7986c2920216?auto=format&fit=crop&w=1200&q=80";
  const Why3 = "https://i.postimg.cc/L8jzdZn5/world-map-with-global-technology-social-connection-network-with-nodes-links-vector-illustration-1284.avif";

  const ser1 = "https://i.postimg.cc/sfk7JwNC/Adobe-Stock-41064239-Preview.jpg";
  const ser2 = "https://i.postimg.cc/52w3zZ4Z/passenger-airliner-flight-17934723.webp";
  const ser3 = "https://i.postimg.cc/C5L9fgn4/premium-photo-1664695368767-c42483a0bda1.jpg";

  const Vid = "https://dl.dropboxusercontent.com/s/bndck8836iy9lk66pyfiu/Hailuo_Video_make-a-video-for-a-global-ship_449363811779067911.mp4";


  /* --- Translations (use \u00A9 in JS if needed; footer uses &copy; in HTML) --- */
  const LANG = {
    en: {
      title: "ThreeWays Shipping — Home",
      meta_desc: "ThreeWays — Fast. Secure. Global. Reliable shipping and freight with real tracking and friendly service.",
      nav_home: "Home", nav_about: "About", nav_services: "Services", nav_contact: "Contact",
      call_us: "Call us:",
      footer_text: "\u00A9 ThreeWays Shipping Company — All rights reserved"
    },
    ar: {
      title: "ThreeWays شركة شحن — الرئيسية",
      meta_desc: "ThreeWays — سريع. آمن. عالمي. شحن موثوق للبضائع مع تتبع حقيقي وخدمة ودودة.",
      nav_home: "الرئيسية", nav_about: "من نحن", nav_services: "خدماتنا", nav_contact: "اتصل بنا",
      call_us: "اتصل بنا:",
      footer_text: "\u00A9 شركة ThreeWays شحن — جميع الحقوق محفوظة"
    }
  };

  /* --- HTML templates: use data-img-key for service images so resolver can set src --- */
  const EN_MAIN_CONTENT = `
    <section id="home" class="hero">
      <video id="heroVideo" class="hero-video" autoplay muted loop playsinline crossorigin="anonymous">
        <source src="${Vid}" type="video/mp4">
      </video>
      <div class="hero-overlay"></div>

      <div class="hero-left">
        <h1>ThreeWays Shipping</h1>
        <p class="lead">Fast. Secure. Global. We deliver packages and freight worldwide with transparent tracking, competitive pricing, and exceptional customer care.</p>
        <div class="hero-cta">
          <a class="btn" href="#services">Our Services</a>
          <a class="btn secondary" href="#contact">Contact Us</a>
        </div>

        <div class="trust-row" aria-hidden="false" style="margin-top:14px">
          <div class="icon">24/7</div>
          <div style="margin-left:10px">
            <div style="font-weight:700">Real-time Support</div>
            <div class="muted">Dedicated agents and live tracking for every shipment.</div>
          </div>
        </div>
      </div>

      <div class="hero-right" aria-hidden="true">
        <div class="hero-card card" style="padding:12px;max-width:360px">
          <h3>Instant Quote</h3>
          <p class="muted">Get an approximate shipping cost for air, sea or ground in seconds — no sign in required.</p>
          <div style="margin-top:12px">
            <a class="btn" href="#contact">Request Quote</a>
          </div>
        </div>
      </div>
    </section>

    <section id="about" class="card">
      <h2>About ThreeWays Shipping</h2>
      <p class="muted">We are a global logistics team simplifying trade and delivery for businesses and individuals. We handle customs paperwork, insurance options, and custom routing to keep goods moving efficiently.</p>
      <p>Founded by logistics professionals with decades of experience, our focus is safety, transparency, and lowering time-in-transit for your cargo.</p>
    </section>

    <section id="services" class="card">
      <h2>Our Services</h2>
      <div class="grid services-grid">
        <div class="card svc">
          <img src="${ser1}" alt="Sea Freight">
          <h3>Sea Freight</h3>
          <p>Full container loads (FCL) and less-than-container (LCL) services with global carrier partnerships.</p>
        </div>

        <div class="card svc">
          <img src="${ser2}" alt="Air Freight">
          <h3>Air Freight</h3>
          <p>Priority air shipping for time-sensitive cargo with airport-to-airport or door-to-door options.</p>
        </div>

        <div class="card svc">
          <img src="${ser3}" alt="Ground Delivery">
          <h3>Ground Delivery</h3>
          <p>Last-mile solutions, local couriers and palletized freight for regional distribution.</p>
        </div>
      </div>
    </section>

    <section class="card why-section">
      <h2>Why Choose ThreeWays?</h2>
      <div class="why-us">
        <div class="why-card">
          <img src="${Why1}" alt="Speed">
          <div class="txt">
            <h3>Speed</h3>
            <p>Optimized routes and express options to keep your supply chain moving.</p>
          </div>
        </div>
        <div class="why-card">
          <img src="${Why2}" alt="Security">
          <div class="txt">
            <h3>Security</h3>
            <p>Secured handling, optional insurance, and tamper-evident packaging for sensitive shipments.</p>
          </div>
        </div>
        <div class="why-card">
          <img src="${Why3}" alt="Global Reach">
          <div class="txt">
            <h3>Global Reach</h3>
            <p>Strong carrier network and customs expertise across continents.</p>
          </div>
        </div>
      </div>
    </section>

    <section class="card comments-wrap" id="testimonialsSection">
      <h2>Customer Stories</h2>
      <p class="muted">Real customers, real results — selected from recent shipments handled by ThreeWays.</p>

      <div class="grid" style="grid-template-columns:repeat(2,1fr);margin-top:12px">
        <div class="card">
          <strong>Ahmed M. — E-commerce Manager</strong>
          <p class="muted" style="margin-top:8px">"ThreeWays cut our international delivery time by 30% and their support helped us resolve a customs hold fast."</p>
        </div>
        <div class="card">
          <strong>Sara L. — Startup Founder</strong>
          <p class="muted" style="margin-top:8px">"Great pricing and the team helped with packaging advice — our fragile items arrived safely."</p>
        </div>
      </div>
    </section>

    <section id="contact" class="card contact-section">
      <div class="left">
        <h2>Contact Us</h2>
        <p class="muted">Phone: <strong id="contactPhone">${SITE_PHONE}</strong> — Email: <a href="mailto:support@threeways.example">threewayssup@gmail.com</a></p>
        <p>Office hours: Sun-Sat, 08:00–18:00 (EGP (Cairo) ). We operate customs clearance & documentation services for import/export.</p>
      </div>
      <div class="right">
        <a class="btn" href="https://wa.me/201113012341" target="_blank" rel="noopener">Message on WhatsApp</a>
        <a class="btn secondary" href="https://www.facebook.com/share/1BZFfNTPkk/" target="_blank" rel="noopener">Visit our Facebook</a>
      </div>
    </section>
  `;

  const AR_MAIN_CONTENT = `
    <section id="home" class="hero">
      <video id="heroVideo" class="hero-video" autoplay muted loop playsinline crossorigin="anonymous">
        <source src="${Vid}" type="video/mp4">
      </video>
      <div class="hero-overlay"></div>

      <div class="hero-left">
        <h1>ThreeWays شركة شحن</h1>
        <p class="lead">سريع. آمن. عالمي. نوفر تتبعًا موثوقًا وخدمة ودودة لشحن الطرود والبضائع حول العالم.</p>
        <div class="hero-cta">
          <a class="btn" href="#services">خدماتنا</a>
          <a class="btn secondary" href="#contact">اتصل بنا</a>
        </div>

        <div class="trust-row" aria-hidden="false" style="margin-top:14px">
          <div class="icon">24/7</div>
          <div style="margin-right:10px">
            <div style="font-weight:700">دعم فوري</div>
            <div class="muted">وكلاء متخصصون وتتبع مباشر لكل شحنة.</div>
          </div>
        </div>
      </div>

      <div class="hero-right" aria-hidden="true">
        <div class="hero-card card" style="padding:12px;max-width:360px">
          <h3>عرض سعر فوري</h3>
          <p class="muted">احصل على تكلفة شحن تقريبية جوية أو بحرية أو برية في ثوانٍ — لا يلزم تسجيل الدخول.</p>
          <div style="margin-top:12px">
            <a class="btn" href="#contact">طلب عرض سعر</a>
          </div>
        </div>
      </div>
    </section>

    <section id="about" class="card">
      <h2>عن شركة ThreeWays</h2>
      <p class="muted">نحن فريق لوجستي عالمي يعمل على تبسيط التجارة والتسليم للشركات والأفراد. نتعامل مع أوراق الجمارك وخيارات التأمين والتوجيه المخصص لضمان تحرك البضائع بكفاءة.</p>
      <p>تأسست الشركة من قبل مختصين في الخدمات اللوجستية بخبرة عقود، ونركز على السلامة والشفافية وتقليل وقت النقل لشحنتك.</p>
    </section>

    <section id="services" class="card">
      <h2>خدماتنا</h2>
      <div class="grid services-grid">
        <div class="card svc">
          <img src="${ser1}" alt="Sea Freight">
          <h3>الشحن البحري</h3>
          <p>خدمات حاويات كاملة (FCL) وأقل من حمولة حاوية (LCL) بشراكات عالمية.</p>
        </div>

        <div class="card svc">
          <img src="${ser2}" alt="Air Freight">
          <h3>الشحن الجوي</h3>
          <p>شحن جوي أولوية للبضائع الحساسة للوقت مع خيارات من مطار إلى مطار أو من الباب إلى الباب.</p>
        </div>

        <div class="card svc">
          <img src="${ser3}" alt="Ground Delivery">
          <h3>التوصيل البري</h3>
          <p>حلول الميل الأخير، وخدمات البريد السريع المحلي، والشحن على منصات نقالة للتوزيع الإقليمي.</p>
        </div>
      </div>
    </section>

    <section class="card why-section">
      <h2>لماذا تختار ThreeWays؟</h2>
      <div class="why-us">
        <div class="why-card">
          <img src="${Why1}" alt="السرعة">
          <div class="txt">
            <h3>السرعة</h3>
            <p>مسارات مُحسّنة وخيارات سريعة للحفاظ على حركة سلسلة التوريد الخاصة بك.</p>
          </div>
        </div>
        <div class="why-card">
          <img src="${Why2}" alt="الأمان">
          <div class="txt">
            <h3>الأمان</h3>
            <p>مناولة مؤمنة، وتأمين اختياري، وتغليف مقاوم للعبث للشحنات الحساسة.</p>
          </div>
        </div>
        <div class="why-card">
          <img src="${Why3}" alt="تغطية عالمية">
          <div class="txt">
            <h3>تغطية عالمية</h3>
            <p>شبكة قوية من شركات النقل والخبرة الجمركية عبر القارات.</p>
          </div>
        </div>
      </div>
    </section>

    <section class="card comments-wrap" id="testimonialsSection">
      <h2>قصص العملاء</h2>
      <p class="muted">عملاء حقيقيون، نتائج حقيقية — مختارة من الشحنات الأخيرة التي تعاملت معها ThreeWays.</p>

      <div class="grid" style="grid-template-columns:repeat(2,1fr);margin-top:12px">
        <div class="card">
          <strong>أحمد م. — مدير التجارة الإلكترونية</strong>
          <p class="muted" style="margin-top:8px">"قلصت ThreeWays وقت التسليم الدولي لدينا بنسبة 30% وساعدنا دعمهم في حل مشكلة جمركية بسرعة."</p>
        </div>
        <div class="card">
          <strong>سارة ل. — مؤسس شركة ناشئة</strong>
          <p class="muted" style="margin-top:8px">"أسعار رائعة وساعدنا الفريق في نصائح التغليف — وصلت أغراضنا القابلة للكسر بأمان."</p>
        </div>
      </div>
    </section>

    <section id="contact" class="card contact-section">
      <div class="left">
        <h2>اتصل بنا</h2>
        <p class="muted">هاتف: <strong id="contactPhone">${SITE_PHONE}</strong> — بريد إلكتروني: <a href="mailto:support@threeways.example">threewayssup@gmail.coml</a></p>
        <p>مواعيد العمل: الأحد - السبت، 08:00 - 18:00 (توقيت مصر القاهرة). نقوم بتشغيل خدمات التخليص الجمركي والتوثيق للاستيراد والتصدير.</p>
      </div>
      <div class="right">
        <a class="btn" href="https://wa.me/201113012341" target="_blank" rel="noopener">راسلنا على WhatsApp</a>
        <a class="btn secondary" href="https://www.facebook.com/share/1BZFfNTPkk/" target="_blank" rel="noopener">قم بزيارة صفحتنا على Facebook</a>
      </div>
    </section>
  `;

  /* ------------------ Image resolver utilities ------------------ */

  function buildFilenameVariants(key, lang) {
    const variants = new Set();
    const base = key.trim();
    const transformations = [
      v => v,
      v => v.toLowerCase(),
      v => v.toUpperCase(),
      v => v.replace(/\s+/g, '-'),
      v => v.replace(/\s+/g, '_'),
      v => v.replace(/\s+/g, '.'),
      v => v.replace(/\s+/g, '')
    ];

    const separators = [
      (a,b)=>`${a}-${b}`,
      (a,b)=>`${a}_${b}`,
      (a,b)=>`${a}${b}`,
      (a,b)=>`${b}-${a}`,
      (a,b)=>`${a} ${b}`,
      (a,b)=>`${a}.${b}`,
      (a,b)=>`${a}`
    ];

    for (const t of transformations) {
      const k = t(base);
      for (const s of separators) {
        variants.add(s(k,lang) + ".jpg");
        variants.add(s(k,lang) + ".png");
        variants.add(k + ".jpg");
        variants.add(k + ".png");
      }
    }
    return Array.from(variants);
  }

  const IMAGE_PREFIXES = [
    "image/",
    "images/",
    "./image/",
    "./images/",
    "/image/",
    "/images/",
    "assets/images/",
    "/assets/images/",
    ""
  ];

  function probeImage(url) {
    return new Promise(resolve => {
      const img = new Image();
      img.onload = () => resolve(true);
      img.onerror = () => resolve(false);
      img.src = url;
      setTimeout(() => resolve(false), 2500);
    });
  }

  async function resolveImageElement(imgEl) {
    const key = imgEl.getAttribute('data-img-key');
    const lang = imgEl.getAttribute('data-img-lang') || 'en';
    if (!key) return;
    const filenames = buildFilenameVariants(key, lang);
    for (const prefix of IMAGE_PREFIXES) {
      for (const name of filenames) {
        const url = prefix + name;
        // eslint-disable-next-line no-await-in-loop
        const ok = await probeImage(url);
        if (ok) {
          imgEl.src = url;
          return;
        }
      }
    }
    imgEl.src = TRANSPARENT_PIXEL;
  }

  function resolveAllImages() {
    const imgs = Array.from(document.querySelectorAll('img[data-img-key]'));
    imgs.forEach(img => {
      resolveImageElement(img).catch(()=>{ img.src = TRANSPARENT_PIXEL; });
    });
  }

  /* ------------------ Language swap + other logic ------------------ */

  function $id(id) { return document.getElementById(id); }
  function $q(selector) { return document.querySelector(selector); }

  function applyLanguage(lang) {
    try {
      const isAR = (lang === 'ar');
      const currentLangData = isAR ? LANG.ar : LANG.en;
      const contentToInject = isAR ? AR_MAIN_CONTENT : EN_MAIN_CONTENT;

      document.documentElement.lang = isAR ? 'ar' : 'en';
      document.documentElement.dir = isAR ? 'rtl' : 'ltr';
      document.title = currentLangData.title;
      $id('meta-description') && $id('meta-description').setAttribute('content', currentLangData.meta_desc);

      $id('pageContent').innerHTML = contentToInject;

      $id('footer-text') && ($id('footer-text').textContent = currentLangData.footer_text);

      document.querySelectorAll('.header [data-i18n]').forEach(node => {
        const key = node.getAttribute('data-i18n');
        if (currentLangData[key]) node.textContent = currentLangData[key];
      });

      $id('phone') && ($id('phone').textContent = SITE_PHONE);
      $id('contactPhone') && ($id('contactPhone').textContent = SITE_PHONE);
      const enBtn = $id('lang-en');
      const arBtn = $id('lang-ar');
      if (enBtn && arBtn) {
        enBtn.classList.toggle('active', !isAR);
        arBtn.classList.toggle('active', isAR);
        enBtn.setAttribute('aria-checked', String(!isAR));
        arBtn.setAttribute('aria-checked', String(isAR));
      }

      heroVideoEnhancements();

      // resolve images AFTER DOM injection (non-blocking)
      setTimeout(resolveAllImages, 30);

      localStorage.setItem('site_lang', lang);
    } catch (e) { console.warn('applyLanguage error:', e); }
  }

  function heroVideoEnhancements(){
    const v = $id('heroVideo');
    if (!v) return;
    try {
      v.muted = true;
      v.playsInline = true;
      v.autoplay = true;
      v.loop = true;

      v.addEventListener('error', () => {
        v.style.display = 'none';
        const hero = $q('.hero');
        if (hero) hero.style.backgroundImage = 'linear-gradient(180deg, #0356b6, #3b82f6)';
      });

      const io = new IntersectionObserver((entries) => {
        entries.forEach(ent => {
          if (ent.isIntersecting) {
            try { v.play().catch(()=>{}); } catch(_) {}
          } else {
            try { v.pause(); } catch(_) {}
          }
        });
      }, { threshold: 0.2 });

      const heroSection = $q('.hero');
      if (heroSection) io.observe(heroSection);
    } catch(e){/*noop*/ }
  }

  document.addEventListener('DOMContentLoaded', () => {
    try {
      const enBtn = $id('lang-en'), arBtn = $id('lang-ar');
      if (enBtn) enBtn.addEventListener('click', () => applyLanguage('en'));
      if (arBtn) arBtn.addEventListener('click', () => applyLanguage('ar'));

      const savedLang = localStorage.getItem('site_lang') || 'en';
      applyLanguage(savedLang);

      const navToggle = $id('navToggle');
      const nav = $q('.nav');
      if (navToggle && nav) {
        navToggle.addEventListener('click', () => {
          const isOpen = nav.classList.toggle('open');
          navToggle.setAttribute('aria-expanded', String(isOpen));
        });

        document.querySelectorAll('.nav a[href^="#"]').forEach(a => {
          a.addEventListener('click', (e) => {
            e.preventDefault();
            const id = a.getAttribute('href').slice(1);
            const el = document.getElementById(id);
            if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
            if (nav && nav.classList.contains('open')) { nav.classList.remove('open'); navToggle.setAttribute('aria-expanded', 'false'); }
          });
        });

        document.addEventListener('click', (ev) => {
          if (window.innerWidth <= 900 && nav && nav.classList.contains('open') &&
              !nav.contains(ev.target) && !navToggle.contains(ev.target)) {
            nav.classList.remove('open');
            navToggle.setAttribute('aria-expanded', 'false');
          }
        });
      }
    } catch (e) { console.warn('init error', e); }
  });
  </script>
    ...  <!-- existing inline script ends here -->
  </script>

  <!-- PASTE THE GALLERY SCRIPT BELOW (exactly) -->
  <script>
  /* GALLERY + HERO VIDEO FIX (drop-in; doesn't change your main script) */
  (function(){
    const GALLERY_INDEX = '/gallery/index.json'; // relative path - recommended
    const GITHUB_REPO = window.GITHUB_REPO || null;

    function createNavLink() {
      if (document.querySelector('.nav a[href="#gallery"]')) return;
      const a = document.createElement('a');
      a.href = '#gallery';
      a.className = 'nav-link';
      const lang = localStorage.getItem('site_lang') || 'en';
      a.textContent = (lang === 'ar') ? 'المعرض' : 'Gallery';
      a.addEventListener('click', (e) => {
        e.preventDefault();
        const el = document.getElementById('gallery');
        if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
      });
      const nav = document.querySelector('.nav');
      if (nav) nav.appendChild(a);
    }

    function fixHeroVideo() {
      const v = document.getElementById('heroVideo');
      if (!v) return;
      try {
        let srcEl = v.querySelector('source');
        if (!srcEl) {
          srcEl = document.createElement('source');
          v.appendChild(srcEl);
        }
        if (typeof Vid !== 'undefined') srcEl.src = Vid;
        if (!srcEl.getAttribute('type')) srcEl.setAttribute('type', 'video/mp4');
        v.load && v.load();
        v.play && v.play().catch(()=>{});
      } catch (e) { /* noop */ }
    }

    function injectGalleryShell() {
      if (document.getElementById('gallery')) return;
      const section = document.createElement('section');
      section.id = 'gallery';
      section.className = 'card gallery-section';
      const lang = localStorage.getItem('site_lang') || 'en';
      section.innerHTML = `
        <h2>${lang === 'ar' ? 'المعرض' : 'Gallery'}</h2>
        <div class="gallery-track" role="list" aria-label="${lang === 'ar' ? 'معرض الصور' : 'Image gallery'}"></div>
        <div class="gallery-msg muted">Loading images…</div>
      `;
      const contact = document.getElementById('contact');
      if (contact) contact.parentNode.insertBefore(section, contact);
      else document.getElementById('pageContent')?.appendChild(section);
    }

    async function fetchGalleryIndex() {
      try {
        const res = await fetch(GALLERY_INDEX, { cache: 'no-cache' });
        if (res.ok) return await res.json();
      } catch (e) {}
      if (GITHUB_REPO && GITHUB_REPO.owner && GITHUB_REPO.repo) {
        try {
          const api = `https://api.github.com/repos/${GITHUB_REPO.owner}/${GITHUB_REPO.repo}/contents/gallery?ref=${GITHUB_REPO.branch || 'main'}`;
          const r = await fetch(api);
          if (!r.ok) throw new Error('gh list fail');
          const json = await r.json();
          return json.filter(i => i.type === 'file').map(f => f.download_url);
        } catch (e) { /* noop */ }
      }
      return null;
    }

    async function loadGalleryImages() {
      const track = document.querySelector('.gallery-track');
      const msg = document.querySelector('.gallery-msg');
      if (!track) return;
      track.innerHTML = '';
      if (msg) msg.style.display = '';
      const data = await fetchGalleryIndex();
      if (!data || !Array.isArray(data) || data.length === 0) {
        if (msg) msg.textContent = 'No images found. Add /gallery/index.json containing filenames or set window.GITHUB_REPO for auto-listing.';
        return;
      }
      const list = data.map(item => {
        if (typeof item === 'string') {
          if (item.startsWith('http') || item.startsWith('data:')) return item;
          return '/gallery/' + item.replace(/^\//, '');
        }
        if (item && item.download_url) return item.download_url;
        return null;
      }).filter(Boolean);

      if (list.length === 0) {
        if (msg) msg.textContent = 'No visible image files found.';
        return;
      }
      if (msg) msg.style.display = 'none';

      list.forEach((src, idx) => {
        const div = document.createElement('div');
        div.className = 'gallery-item';
        const img = document.createElement('img');
        img.src = src;
        img.alt = `image-${idx}`;
        img.loading = 'lazy';
        div.appendChild(img);
        div.addEventListener('click', () => openLightbox(list, idx));
        track.appendChild(div);
      });
    }

    let lbOverlay = null, lbImg = null, currentIndex = 0, lbList = [];

    function buildLightbox() {
      if (lbOverlay) return;
      lbOverlay = document.createElement('div');
      lbOverlay.className = 'gallery-lightbox';
      lbOverlay.innerHTML = `
        <div class="lb-controls">
          <button class="lb-btn lb-close" aria-label="Close">Close</button>
        </div>
        <button class="lb-nav lb-prev" aria-label="Previous">&larr;</button>
        <img class="lb-image" src="" alt="">
        <button class="lb-nav lb-next" aria-label="Next">&rarr;</button>
      `;
      document.body.appendChild(lbOverlay);
      lbImg = lbOverlay.querySelector('.lb-image');

      lbOverlay.querySelector('.lb-close').addEventListener('click', closeLightbox);
      lbOverlay.querySelector('.lb-prev').addEventListener('click', showPrev);
      lbOverlay.querySelector('.lb-next').addEventListener('click', showNext);

      window.addEventListener('keydown', (e) => {
        if (!lbOverlay.classList.contains('open')) return;
        if (e.key === 'Escape') closeLightbox();
        if (e.key === 'ArrowLeft') showPrev();
        if (e.key === 'ArrowRight') showNext();
      });

      let startX = null;
      lbOverlay.addEventListener('touchstart', (ev) => { startX = ev.touches[0].clientX; });
      lbOverlay.addEventListener('touchend', (ev) => {
        if (startX === null) return;
        const dx = ev.changedTouches[0].clientX - startX;
        if (dx > 40) showPrev();
        else if (dx < -40) showNext();
        startX = null;
      });

      lbOverlay.addEventListener('click', (e) => {
        if (e.target === lbOverlay) closeLightbox();
      });
    }

    function openLightbox(list, idx) {
      buildLightbox();
      lbList = list.slice();
      currentIndex = idx;
      lbImg.src = lbList[currentIndex];
      lbOverlay.classList.add('open');
      document.body.style.overflow = 'hidden';
    }
    function closeLightbox() {
      if (!lbOverlay) return;
      lbOverlay.classList.remove('open');
      document.body.style.overflow = '';
      lbImg.src = '';
    }
    function showPrev() {
      if (!lbList.length) return;
      currentIndex = (currentIndex - 1 + lbList.length) % lbList.length;
      lbImg.src = lbList[currentIndex];
    }
    function showNext() {
      if (!lbList.length) return;
      currentIndex = (currentIndex + 1) % lbList.length;
      lbImg.src = lbList[currentIndex];
    }

    function attachObserver() {
      const pc = document.getElementById('pageContent');
      if (!pc) { setTimeout(attachObserver, 60); return; }
      createNavLink();
      const mo = new MutationObserver((list) => {
        fixHeroVideo();
        injectGalleryShell();
        loadGalleryImages();
      });
      mo.observe(pc, { childList: true, subtree: true });

      setTimeout(() => {
        fixHeroVideo();
        injectGalleryShell();
        loadGalleryImages();
      }, 80);
    }

    document.addEventListener('DOMContentLoaded', attachObserver);
  })();
  </script>

</body>
</html>

</body>
</html>
